<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Balance Sheet</title>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
  <style>
    table {
      border-collapse: collapse;
      width: 100%;
    }
    th, td {
      border: 1px solid black;
      text-align: center;
      padding: 8px;
    }
    th {
      background-color: #add8e6;
    }
    .red {
      background-color: red;
      color: white;
    }
    .light-green {
      background-color: #d3f9d8;
    }
    .aqua {
      background-color: aqua;
    }
    .light-blue {
      background-color: #e0f0ff;
    }
    .light-orange {
      background-color: #ffe5cc;
    }
    .total-row {
      background-color: #ccffcc;
      font-weight: bold;
    }
    .yellow-sum {
      background-color: yellow;
      font-weight: bold;
    }
    .orange-sum {
      background-color: orange;
      font-weight: bold;
    }

    /* Capitalize and center text inputs and select */
    input[type="text"], select {
      text-transform: uppercase;
      text-align: center;
    }

    input[type="number"], select {
      text-align: center;
    }

    input[type="text"], input[type="number"], input[type="date"], select {
      width: 100%;
      box-sizing: border-box;
      padding: 4px;
    }

    th, td, input, select {
      font-weight: bold;
    }
    
    .green-sum {
      background-color: #90ee90;
      font-weight: bold;
      text-align: center;
      font-size: 16px;
    }



  </style>
</head>
<body>
  <form id="balanceForm">
    <table id="balanceTable">
      <tr>
        <td colspan="10" style="background-color: #cceeff; text-align: left;">
          <div style="display: flex; gap: 20px; padding: 8px; align-items: center;">
            <div>
              <label style="font-weight: bold;">BRANCH NAME:</label><br />
              <input type="text" id="branchName" />
            </div>
            <div>
              <label style="font-weight: bold;">DATE:</label><br />
              <input type="date" id="reportDate" />
            </div>
            <div>
              <label style="font-weight: bold;">SHIFT:</label><br />
              <select id="shift">
                <option value="">Select</option>
                <option value="Morning">Morning</option>
                <option value="Night">Night</option>
              </select>
            </div>
          </div>
        </td>
      </tr>

      <tr>
        <th>SITE NAME</th>
        <th>PUNTER BALANCE</th>
        <th>PLUS</th>
        <th class="red">MINUS</th>
        <th class="light-green">NAME</th>
        <th class="light-green">DENA</th>
        <th class="light-green">NAME</th>
        <th class="aqua">LENA</th>
        <th>BANK NAME</th>
        <th>BANK BALANCE</th>
      </tr>

      <tr>
        <td><input type="text" name="site[]" /></td>
        <td><input type="number" class="punter" value="0" /></td>
        <td><input type="number" class="plus" value="0" /></td>
        <td><input type="number" class="minus" value="0" /></td>
        <td><input type="text" name="name1[]" /></td>
        <td><input type="number" class="dena" value="0" /></td>
        <td><input type="text" name="name2[]" /></td>
        <td><input type="number" class="lena" value="0" /></td>
        <td><input type="text" name="bankName[]" /></td>
        <td><input type="number" class="bank" value="0" /></td>
      </tr>

      <tr class="total-row">
        <td>TOTAL</td>
        <td id="totalPunter">0</td>
        <td id="totalPlus">0</td>
        <td id="totalMinus">0</td>
        <td></td>
        <td id="totalDena">0</td>
        <td></td>
        <td id="totalLena">0</td>
        <td></td>
        <td id="totalBank">0</td>
      </tr>

      <tr>
        <td colspan="6" class="yellow-sum" id="yellowSum">0</td>
        <td colspan="4" class="orange-sum" id="orangeSum">0</td>
      </tr>
      <tr id="greenRow">
        <td colspan="10" class="green-sum">Final Balance: ₹ 0</td>
      </tr>


    </table>

    <br />
    <button type="button" onclick="addRow()" class="no-print" id="addRowBtn">Add One More Row</button>
    <button type="button" onclick="exportPDF()" class="no-print">Export PDF</button>
  </form>

  <script>
    function addRow() {
      const table = document.getElementById("balanceTable");
      const row = table.insertRow(table.rows.length - 3);
      const columns = [
        '<input type="text" name="site[]" />',
        '<input type="number" class="punter" value="0" />',
        '<input type="number" class="plus" value="0" />',
        '<input type="number" class="minus" value="0" />',
        '<input type="text" name="name1[]" />',
        '<input type="number" class="dena" value="0" />',
        '<input type="text" name="name2[]" />',
        '<input type="number" class="lena" value="0" />',
        '<input type="text" name="bankName[]" />',
        '<input type="number" class="bank" value="0" />'
      ];
      for (let i = 0; i < columns.length; i++) {
        const cell = row.insertCell(i);
        cell.innerHTML = columns[i];
      }
      attachListeners();
    }

    function calculateTotals() {
      const sum = selector => Array.from(document.querySelectorAll(selector))
        .reduce((acc, input) => acc + parseFloat(input.value || 0), 0);

      const punter = sum(".punter");
      const plus = sum(".plus");
      const minus = sum(".minus");
      const dena = sum(".dena");
      const lena = sum(".lena");
      const bank = sum(".bank");

      const yellowTotal = punter + plus - minus + dena;
      const orangeTotal = lena + bank;
      const greenTotal = yellowTotal - orangeTotal;

      document.getElementById("totalPunter").textContent = punter;
      document.getElementById("totalPlus").textContent = plus;
      document.getElementById("totalMinus").textContent = minus;
      document.getElementById("totalDena").textContent = dena;
      document.getElementById("totalLena").textContent = lena;
      document.getElementById("totalBank").textContent = bank;

      document.getElementById("yellowSum").textContent = yellowTotal;
      document.getElementById("orangeSum").textContent = orangeTotal;
      document.getElementById("greenRow").querySelector("td").textContent =
        `Balance: ₹ ${greenTotal}`;
    }


    function attachListeners() {
      document.querySelectorAll("input[type='number']")
        .forEach(input => input.addEventListener("input", calculateTotals));
    }

    function exportPDF() {
      const form = document.getElementById("balanceForm");
      const buttons = form.querySelectorAll(".no-print");
      buttons.forEach(btn => btn.style.display = "none");

      html2canvas(form, { scale: 2 }).then(canvas => {
        const imgData = canvas.toDataURL("image/png");
        const pdf = new jspdf.jsPDF({
          orientation: 'landscape', // ← switched to vertical
          unit: 'mm',
          format: 'a4'
        });

        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();

        const imgProps = pdf.getImageProperties(imgData);
        const imgWidth = pageWidth;
        const imgHeight = (imgProps.height * imgWidth) / imgProps.width;

        let y = 0;
        if (imgHeight < pageHeight) {
          y = (pageHeight - imgHeight) / 2;
        }

        pdf.addImage(imgData, 'PNG', 0, y, imgWidth, imgHeight);
        pdf.save("balance-sheet.pdf");

        buttons.forEach(btn => btn.style.display = "inline-block");
      });
    }

    attachListeners();
    calculateTotals();
  </script>
</body>
</html>
